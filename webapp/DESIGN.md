# Mini Video App 设计文档

## 1. 整体架构与流程 (User Flow)

```mermaid
graph TD
    A[用户在 Telegram Bot 点击<br>"🔍 搜索视频"] --> B(打开 Mini App)
    B --> C{鉴权 & 获取配置}
    C -->|失败| D[提示在 Telegram 打开]
    C -->|成功| E[加载首页]
    
    E --> F[顶部: 搜索栏]
    E --> G[Banner 轮播区]
    E --> H[分类 Tab 栏]
    E --> I[视频流列表]
    E --> J[底部: 用户信息 & VIP 状态]
    
    I -->|点击视频| K{判断会员状态}
    K -->|是 VIP| L[跳转付费频道<br>观看完整视频]
    K -->|非 VIP| M{是否有免费预览?}
    
    M -->|有| N[跳转免费频道<br>观看剪辑]
    M -->|无| O[弹出 VIP 购买弹窗]
    
    O -->|点击套餐| P[跳转 Bot 支付流程]
    J -->|点击升级| O
```

## 2. 界面布局设计 (UI Wireframe)

### 2.1 首页 (Home Screen)

```text
+-----------------------------------+
|  [🔍 搜索视频...                ] |  <-- 顶部固定搜索栏
+-----------------------------------+
|  [ Banner 图片 1 (可滑动)      ]  |  <-- 运营活动/广告位
+-----------------------------------+
|  (全部) (国产) (日韩) (欧美) ...  |  <-- 横向滚动分类
+-----------------------------------+
|  <u>最新</u>   热门                   |  <-- 排序切换
+-----------------------------------+
|                                   |
|  +-----------------------------+  |
|  |        视频封面区域         |  |
|  |           [▶️]              |  |  <-- 视频卡片
|  | [HOT]                   [🔒]|  |      (非会员显示锁)
|  +-----------------------------+  |
|  标题：某某视频完整版...          |
|  👁 1.2k views       2023-10-27   |
|                                   |
|  +-----------------------------+  |
|  |        视频封面区域         |  |
|  |           [▶️]              |  |
|  |                         [🔒]|  |
|  +-----------------------------+  |
|  标题：另一个视频...              |
|                                   |
+-----------------------------------+
| [U] User123   [Free]  [升级VIP]   |  <-- 底部固定用户信息栏
+-----------------------------------+
```

### 2.2 购买弹窗 (Purchase Modal)

```text
+-----------------------------------+
|                                   |
|      选择会员套餐                 |
|                                   |
|  +-----------------------------+  |
|  | ⚡️ 月费会员           $1.99 |  |
|  |    30 天有效期              |  |
|  +-----------------------------+  |
|                                   |
|  +-----------------------------+  |
|  | ⚡️ 季度会员           $3.99 |  |
|  |    90 天有效期              |  |
|  +-----------------------------+  |
|                                   |
|  +-----------------------------+  |
|  | ⚡️ 年费会员          $15.99 |  |
|  |    365 天有效期             |  |
|  +-----------------------------+  |
|                                   |
|       (通过 Bot 支付)             |
|                                   |
|            [ 关闭 ]               |
+-----------------------------------+
```

## 3. 视觉规范 (Visual Guidelines)

基于 **Tailwind CSS** 与 **Telegram Web App 官方主题** 自适应：

*   **色彩系统 (Color System)**:
    *   **背景色**: `var(--tg-theme-bg-color)` (自动跟随 TG 深色/浅色模式)
    *   **卡片/次级背景**: `var(--tg-theme-secondary-bg-color)`
    *   **文本**: `var(--tg-theme-text-color)`
    *   **主色调 (Primary)**: `#3b82f6` (Blue-500) - 用于按钮、高亮 Tab
    *   **强调色 (Accent)**: `#ef4444` (Red-500) - 用于 HOT 标签
    *   **状态色**:
        *   VIP: `#fef3c7` (背景) / `#92400e` (文字) - 金色质感
        *   Free: `#e5e7eb` (背景) / `#4b5563` (文字) - 灰色质感

*   **排版 (Typography)**:
    *   标题: `font-weight: 500/700`, 截断处理 (`line-clamp-2`)
    *   辅助信息: `text-xs`, `text-gray-500`

*   **交互 (Interaction)**:
    *   **点击反馈**: 卡片点击时透明度降低 (`hover:opacity-80`)
    *   **滚动**: 分类栏隐藏滚动条 (`hide-scrollbar`)
    *   **加载**: 骨架屏或 Loading 提示
    *   **跳转**: 使用 `tg.openTelegramLink()` 实现 Telegram 内部无缝跳转

## 4. 功能模块说明

| 模块 | 功能点 | 后台对应 |
| :--- | :--- | :--- |
| **搜索** | 实时搜索标题关键词 | `GET /api/webapp/videos?q=xxx` |
| **分类** | 筛选视频类型 | `GET /api/webapp/config` (Categories) |
| **Banner** | 顶部广告位/活动入口 | `GET /api/webapp/config` (Banners) |
| **视频流** | 分页加载、按最新/热度排序 | `GET /api/webapp/videos` |
| **鉴权** | 识别用户、判断 VIP 状态 | `GET /api/webapp/auth` (校验 initData) |
| **跳转** | 区分付费/免费链接逻辑 | 前端逻辑判断 `is_locked` 与 `free_link` |

